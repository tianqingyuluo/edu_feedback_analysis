<script setup>
import { ref, onMounted } from "vue";
import * as echarts from "echarts";

const jsonData = {
  labels: [
    "学习情况_均值", "思政课_均值", "专业课_均值", "体育教育_均值",
    "美育教育_均值", "劳动教育_均值", "校园生活_均值", "实习_均值",
    "自我提升_均值", "老师教育_均值", "学校服务_均值", "学校基础条件_均值"
  ],
  matrix: [
    [1.0, 0.4844901771, 0.5340979198, 0.4167182697, 0.4215325046, 0.4277830906, 0.5037861518, 0.4844681834, 0.5557760627, 0.4273648390, 0.4925000958, 0.4791581188],
    [0.4844901771, 1.0, 0.7530734041, 0.6349561833, 0.5842628089, 0.6082580389, 0.3580444637, 0.6228033819, 0.6960766617, 0.7145814347, 0.7036766429, 0.6418378964],
    [0.5340979198, 0.7530734041, 1.0, 0.6308514283, 0.6071570935, 0.6157524782, 0.3916650084, 0.6631584290, 0.7525228554, 0.7207241802, 0.7199148493, 0.6411615098],
    [0.4167182697, 0.6349561833, 0.6308514283, 1.0, 0.6412119794, 0.6619125762, 0.3503136346, 0.5890044270, 0.6209926783, 0.5987434335, 0.6302529020, 0.5878253840],
    [0.4215325046, 0.5842628089, 0.6071570935, 0.6412119794, 1.0, 0.6967925926, 0.3737834951, 0.5825084104, 0.5943411143, 0.5370724447, 0.6042710653, 0.5643618940],
    [0.4277830906, 0.6082580389, 0.6157524782, 0.6619125762, 0.6967925926, 1.0, 0.3739030976, 0.6009056330, 0.6081673951, 0.5560002058, 0.6245654505, 0.5806812942],
    [0.5037861518, 0.3580444637, 0.3916650084, 0.3503136346, 0.3737834951, 0.3739030976, 1.0, 0.4134411370, 0.4434430732, 0.3511337278, 0.4138072543, 0.3831457543],
    [0.4844681834, 0.6228033819, 0.6631584290, 0.5890044270, 0.5825084104, 0.6009056330, 0.4134411370, 1.0, 0.7345115078, 0.6350139624, 0.7421731970, 0.6830609687],
    [0.5557760627, 0.6960766617, 0.7525228554, 0.6209926783, 0.5943411143, 0.6081673951, 0.4434430732, 0.7345115078, 1.0, 0.7603185636, 0.8179779377, 0.7206788602],
    [0.4273648390, 0.7145814347, 0.7207241802, 0.5987434335, 0.5370724447, 0.5560002058, 0.3511337278, 0.6350139624, 0.7603185636, 1.0, 0.8122599863, 0.6708466692],
    [0.4925000958, 0.7036766429, 0.7199148493, 0.6302529020, 0.6042710653, 0.6245654505, 0.4138072543, 0.7421731970, 0.8179779377, 0.8122599863, 1.0, 0.7803264202],
    [0.4791581188, 0.6418378964, 0.6411615098, 0.5878253840, 0.5643618940, 0.5806812942, 0.3831457543, 0.6830609687, 0.7206788602, 0.6708466692, 0.7803264202, 1.0]
  ]
};

const chartRef = ref(null);

onMounted(() => {
  const chart = echarts.init(chartRef.value);
  
  const data = [];
  const labels = jsonData.labels;
  
  jsonData.matrix.forEach((row, i) => {
    row.forEach((val, j) => {
      data.push([j, i, val.toFixed(2)]);
    });
  });
  
  const option = {
    tooltip: {
      position: "top",
      formatter: (params) => {
        return `<b>${labels[params.value[1]]}</b> vs <b>${labels[params.value[0]]}</b><br/>相关系数: <b>${params.value[2]}</b>`;
      }
    },
    grid: {
      left: "18%",
      top: "10%",
      right: "10%",
      bottom: "18%"
    },
    xAxis: {
      type: "category",
      data: labels,
      splitArea: {show: true},
      axisLabel: {rotate: 45, fontSize: 12}
    },
    yAxis: {
      type: "category",
      data: labels,
      splitArea: {show: true},
      axisLabel: {fontSize: 12}
    },
    visualMap: {
      min: -1,
      max: 1,
      calculable: true,
      orient: "vertical",
      left: "left",
      top: "center",
      precision: 2,
      inRange: {
        color: ["#2166ac", "#f7f7f7", "#b2182b"]
      }
    },
    series: [
      {
        name: "相关性",
        type: "heatmap",
        data,
        label: {
          show: true,
          formatter: (p) => p.value[2],
          color: "#000",
          fontSize: 11
        },
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowColor: "rgba(0, 0, 0, 0.5)"
          }
        }
      }
    ]
  };
  
  chart.setOption(option);
});
</script>

<template>
<div class="w-full h-screen flex items-center justify-center">
  <div ref="chartRef" class="w-[1000px] h-[800px]"></div>
</div>
</template>
